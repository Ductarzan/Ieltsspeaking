<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI English - Luyện thi IELTS Speaking</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
        }
        .gradient-text {
            background: linear-gradient(90deg, #4361EE, #7209B7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .section-bg-light {
            background-color: #F8F9FA;
        }
        .cta-bg-dark {
            background-color: #0B051D;
        }
        .loader {
            border: 4px solid #e0e0e0;
            border-top: 4px solid #4361EE;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .pulsing-mic {
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(67, 97, 238, 0.7); }
            70% { box-shadow: 0 0 0 25px rgba(67, 97, 238, 0); }
            100% { box-shadow: 0 0 0 0 rgba(67, 97, 238, 0); }
        }
        .sidebar-item.active { background-color: #eff6ff; color: #2563eb; }
        .sidebar-item.active .fa-solid { color: #2563eb; }
        .progress-bar-bg { background-color: #e5e7eb; }
        .progress-bar-fill { background-color: #3b82f6; }
        .page { display: none; }
        .page.active { display: block; }
        #auth-container .tab {
            cursor: pointer;
            padding: 10px 20px;
            border-bottom: 3px solid transparent;
        }
        #auth-container .tab.active {
            border-bottom-color: #4361EE;
            color: #4361EE;
            font-weight: 600;
        }
        .auth-form { display: none; }
        .auth-form.active { display: block; }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 0.75rem;
            max-width: 90%;
            width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        .faq-item summary {
            cursor: pointer;
            outline: none;
        }
        .faq-item[open] summary .arrow-down {
            transform: rotate(180deg);
        }
    </style>
</head>
<body class="text-slate-800 antialiased">

    <!-- Header chung -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="#" class="nav-link font-bold text-2xl" data-page="home">AI<span class="text-blue-600">English</span></a>
            <div class="hidden md:flex items-center space-x-8">
                <a href="#features" class="text-slate-600 hover:text-blue-600">Tính năng</a>
                <a href="#how-it-works" class="text-slate-600 hover:text-blue-600">Cách hoạt động</a>
                <a href="#testimonials" class="text-slate-600 hover:text-blue-600">Đánh giá</a>
            </div>
            <!-- Auth state buttons -->
            <div id="auth-nav-logged-out">
                 <button class="nav-link bg-blue-600 hover:bg-blue-700 text-white font-semibold px-5 py-2 rounded-lg" data-page="auth">Đăng nhập / Đăng ký</button>
            </div>
            <div id="auth-nav-logged-in" class="hidden items-center space-x-4">
                <a href="#" id="history-link" class="text-slate-600 hover:text-blue-600 font-semibold">Lịch sử</a>
                <span id="user-email-display" class="font-semibold text-slate-700"></span>
                <button id="logout-btn" class="text-slate-600 hover:text-blue-600">Đăng xuất</button>
            </div>
        </nav>
    </header>

    <main id="app">
        <!-- Trang chủ -->
        <div id="home-page" class="page active">
            <!-- Hero Section -->
            <section class="py-24 bg-white">
                <div class="container mx-auto px-6 grid md:grid-cols-2 gap-12 items-center">
                    <div class="text-center md:text-left">
                        <h1 class="text-4xl md:text-6xl font-extrabold text-slate-900 mb-4 leading-tight">Chấm điểm IELTS Speaking<br>Tức thì với <span class="gradient-text">AI</span></h1>
                        <p class="text-slate-600 text-lg mb-8 max-w-xl mx-auto md:mx-0">Nhận điểm chi tiết cho 4 tiêu chí Fluency, Pronunciation, Grammar, và Vocabulary chỉ trong vòng 2 phút.</p>
                        <button class="nav-link bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-8 rounded-lg text-lg shadow-lg transform hover:scale-105 transition-transform" data-page="auth">Làm bài thi thử miễn phí</button>
                    </div>
                    <div>
                        <img src="https://gcs.tripi.vn/public-tripi/tripi-feed/img/475051aAa/top-16-chu-de-thuong-gap-khi-thi-ielts-speaking-phan-2-1.png" alt="Học sinh đang học trực tuyến" class="rounded-xl shadow-2xl w-full" onerror="this.onerror=null;this.src='https://placehold.co/600x400/a3bffa/ffffff?text=IELTS+Practice';">
                    </div>
                </div>
            </section>
            
            <!-- Features Section -->
            <section id="features" class="section-bg-light py-20">
                <div class="container mx-auto px-6">
                    <div class="text-center mb-16">
                         <h2 class="text-3xl md:text-4xl font-bold text-slate-900">Tại sao nên chọn AI English?</h2>
                         <p class="text-slate-500 mt-2">Công cụ luyện thi toàn diện nhất dành cho bạn.</p>
                    </div>
                    <div class="grid md:grid-cols-3 gap-10">
                        <div class="text-center p-8 bg-white rounded-lg shadow-md">
                            <i class="fa-solid fa-bolt-lightning text-4xl text-blue-600 mb-4"></i>
                            <h3 class="text-xl font-bold mb-2">Chấm điểm tức thì</h3>
                            <p class="text-slate-600">Không cần chờ đợi. Nhận kết quả phân tích chi tiết ngay sau khi bạn hoàn thành bài nói.</p>
                        </div>
                        <div class="text-center p-8 bg-white rounded-lg shadow-md">
                            <i class="fa-solid fa-magnifying-glass-chart text-4xl text-blue-600 mb-4"></i>
                            <h3 class="text-xl font-bold mb-2">Phân tích chuyên sâu</h3>
                            <p class="text-slate-600">Hiểu rõ điểm mạnh, điểm yếu qua các phân tích về tốc độ nói, ngữ điệu, và các lỗi sai thường gặp.</p>
                        </div>
                        <div class="text-center p-8 bg-white rounded-lg shadow-md">
                            <i class="fa-solid fa-infinity text-4xl text-blue-600 mb-4"></i>
                            <h3 class="text-xl font-bold mb-2">Luyện tập không giới hạn</h3>
                            <p class="text-slate-600">Truy cập kho đề thi đa dạng, luyện tập mọi lúc mọi nơi để nhanh chóng cải thiện kỹ năng.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- How It Works Section -->
            <section id="how-it-works" class="py-20 bg-white">
                <div class="container mx-auto px-6">
                    <div class="text-center mb-20">
                        <h2 class="text-3xl md:text-4xl font-bold text-slate-900">Chỉ với 3 bước đơn giản</h2>
                        <p class="text-slate-500 mt-2">Bắt đầu hành trình chinh phục IELTS Speaking ngay hôm nay.</p>
                    </div>
                    <div class="relative">
                        <!-- Dotted line for desktop -->
                        <div class="hidden md:block absolute top-12 left-0 w-full h-px">
                            <div class="w-full border-t-2 border-dashed border-gray-300"></div>
                        </div>
            
                        <div class="relative grid md:grid-cols-3 gap-12">
                            <!-- Step 1 -->
                            <div class="text-center bg-white z-10">
                                <div class="flex items-center justify-center w-24 h-24 mx-auto mb-6 bg-white border-2 border-blue-200 text-blue-600 rounded-full text-4xl font-bold shadow-lg">
                                    <i class="fa-solid fa-microphone-lines"></i>
                                </div>
                                <h3 class="text-xl font-bold mb-2">1. Ghi âm bài nói</h3>
                                <p class="text-slate-600 px-4">Chọn một chủ đề và ghi âm lại câu trả lời của bạn trong vòng 2 phút.</p>
                            </div>
                            <!-- Step 2 -->
                            <div class="text-center bg-white z-10">
                                <div class="flex items-center justify-center w-24 h-24 mx-auto mb-6 bg-white border-2 border-blue-200 text-blue-600 rounded-full text-4xl font-bold shadow-lg">
                                     <i class="fa-solid fa-brain"></i>
                                </div>
                                <h3 class="text-xl font-bold mb-2">2. AI phân tích</h3>
                                <p class="text-slate-600 px-4">Hệ thống AI thông minh sẽ phiên âm và phân tích bài nói của bạn trên nhiều phương diện.</p>
                            </div>
                            <!-- Step 3 -->
                            <div class="text-center bg-white z-10">
                                <div class="flex items-center justify-center w-24 h-24 mx-auto mb-6 bg-white border-2 border-blue-200 text-blue-600 rounded-full text-4xl font-bold shadow-lg">
                                    <i class="fa-solid fa-chart-line"></i>
                                </div>
                                <h3 class="text-xl font-bold mb-2">3. Nhận kết quả</h3>
                                <p class="text-slate-600 px-4">Xem điểm số chi tiết, nhận xét và các gợi ý cải thiện để tiến bộ hơn.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Testimonials Section -->
            <section id="testimonials" class="section-bg-light py-20">
                <div class="container mx-auto px-6">
                    <div class="text-center mb-16">
                         <h2 class="text-3xl md:text-4xl font-bold text-slate-900">Học viên nói gì về chúng tôi?</h2>
                    </div>
                    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                        <div class="bg-white p-6 rounded-lg shadow">
                            <p class="text-slate-600 mb-4">"Công cụ này thật tuyệt vời! Nhờ có AI English mà mình đã tự tin hơn hẳn khi nói và cải thiện được band điểm từ 6.0 lên 7.5."</p>
                            <div class="flex items-center">
                                <img src="https://i.pravatar.cc/40?u=a042581f4e29026704d" alt="Avatar" class="w-10 h-10 rounded-full mr-4">
                                <div>
                                    <p class="font-bold">Minh Anh</p>
                                    <p class="text-sm text-slate-500">Sinh viên, Hà Nội</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow">
                            <p class="text-slate-600 mb-4">"Phần phân tích lỗi sai rất chi tiết, giúp mình biết chính xác cần phải sửa ở đâu. Rất đáng để sử dụng."</p>
                            <div class="flex items-center">
                                <img src="https://i.pravatar.cc/40?u=a042581f4e29026705d" alt="Avatar" class="w-10 h-10 rounded-full mr-4">
                                <div>
                                    <p class="font-bold">Quốc Bảo</p>
                                    <p class="text-sm text-slate-500">Nhân viên văn phòng, TP.HCM</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow md:col-span-2 lg:col-span-1">
                            <p class="text-slate-600 mb-4">"Giao diện thân thiện, dễ sử dụng. Mình có thể luyện tập mọi lúc mọi nơi. Cảm ơn đội ngũ phát triển!"</p>
                            <div class="flex items-center">
                                <img src="https://i.pravatar.cc/40?u=a042581f4e29026706d" alt="Avatar" class="w-10 h-10 rounded-full mr-4">
                                <div>
                                    <p class="font-bold">Thảo Nhi</p>
                                    <p class="text-sm text-slate-500">Học sinh, Đà Nẵng</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- FAQ Section -->
            <section class="py-20 bg-white">
                <div class="container mx-auto px-6 max-w-3xl">
                    <div class="text-center mb-16">
                         <h2 class="text-3xl md:text-4xl font-bold text-slate-900">Câu hỏi thường gặp</h2>
                    </div>
                    <div class="space-y-4">
                        <details class="faq-item bg-gray-50 p-4 rounded-lg">
                            <summary class="font-semibold flex justify-between items-center">AI chấm điểm có chính xác không? <i class="fa-solid fa-chevron-down arrow-down transition-transform"></i></summary>
                            <p class="mt-2 text-slate-600">Hệ thống AI của chúng tôi được huấn luyện trên hàng nghìn bài thi mẫu và tuân thủ chặt chẽ 4 tiêu chí chấm điểm chính thức của IELTS, đảm bảo độ chính xác cao và nhất quán.</p>
                        </details>
                        <details class="faq-item bg-gray-50 p-4 rounded-lg">
                            <summary class="font-semibold flex justify-between items-center">Tôi có thể làm bao nhiêu bài thi thử? <i class="fa-solid fa-chevron-down arrow-down transition-transform"></i></summary>
                            <p class="mt-2 text-slate-600">Bạn có thể làm một số lượng bài thi thử miễn phí nhất định. Để có thể luyện tập không giới hạn với đầy đủ các chủ đề, bạn có thể cân nhắc nâng cấp lên gói trả phí của chúng tôi.</p>
                        </details>
                        <details class="faq-item bg-gray-50 p-4 rounded-lg">
                            <summary class="font-semibold flex justify-between items-center">Dữ liệu của tôi có được bảo mật không? <i class="fa-solid fa-chevron-down arrow-down transition-transform"></i></summary>
                            <p class="mt-2 text-slate-600">Chúng tôi cam kết bảo mật tuyệt đối thông tin cá nhân và dữ liệu bài thi của bạn. Mọi thông tin đều được mã hóa và chỉ được sử dụng cho mục đích chấm điểm và phân tích.</p>
                        </details>
                    </div>
                </div>
            </section>
            
            <!-- Final CTA Section -->
            <section class="cta-bg-dark text-white py-20">
                <div class="container mx-auto px-6 text-center">
                    <h2 class="text-3xl md:text-4xl font-bold mb-4">Sẵn sàng chinh phục IELTS Speaking?</h2>
                    <p class="mb-8 text-slate-300 max-w-2xl mx-auto">Đừng để kỹ năng nói cản bước bạn. Bắt đầu luyện tập với AI và cảm nhận sự khác biệt ngay hôm nay.</p>
                    <button class="nav-link bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-8 rounded-lg text-lg shadow-lg transform hover:scale-105 transition-transform" data-page="auth">Bắt đầu ngay</button>
                </div>
            </section>
            
            <footer class="bg-slate-900 text-slate-400 py-12">
                <div class="container mx-auto px-6 text-center">
                    <p>&copy; 2024 AI English. All rights reserved.</p>
                </div>
            </footer>
        </div>

        <!-- Trang Đăng nhập / Đăng ký -->
        <div id="auth-page" class="page">
            <div class="flex items-center justify-center min-h-screen">
                <div id="auth-container" class="w-full max-w-md p-8 bg-white rounded-xl shadow-lg">
                    <div class="flex justify-center border-b mb-6">
                        <div id="login-tab" class="tab active" onclick="switchAuthForm('login')">Đăng nhập</div>
                        <div id="register-tab" class="tab" onclick="switchAuthForm('register')">Đăng ký</div>
                    </div>
                    <form id="login-form" class="auth-form active space-y-6">
                        <h2 class="text-2xl font-bold text-center text-slate-800">Chào mừng trở lại!</h2>
                        <div>
                            <label for="login-email" class="text-sm font-medium text-slate-700">Địa chỉ Email</label>
                            <input type="email" id="login-email" required class="w-full px-4 py-2 mt-2 border border-slate-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" placeholder="you@example.com">
                        </div>
                        <div>
                            <label for="login-password" class="text-sm font-medium text-slate-700">Mật khẩu</label>
                            <input type="password" id="login-password" required class="w-full px-4 py-2 mt-2 border border-slate-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" placeholder="********">
                        </div>
                        <p id="login-error" class="text-sm text-red-500"></p>
                        <button type="submit" class="w-full px-4 py-3 font-semibold text-white bg-blue-600 rounded-lg hover:bg-blue-700">Đăng nhập</button>
                    </form>
                     <form id="register-form" class="auth-form space-y-6">
                        <h2 class="text-2xl font-bold text-center text-slate-800">Tạo tài khoản mới</h2>
                        <div>
                            <label for="register-email" class="text-sm font-medium text-slate-700">Địa chỉ Email</label>
                            <input type="email" id="register-email" required class="w-full px-4 py-2 mt-2 border border-slate-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" placeholder="you@example.com">
                        </div>
                        <div>
                            <label for="register-password" class="text-sm font-medium text-slate-700">Mật khẩu</label>
                            <input type="password" id="register-password" required minlength="6" class="w-full px-4 py-2 mt-2 border border-slate-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" placeholder="Ít nhất 6 ký tự">
                        </div>
                        <p id="register-error" class="text-sm text-red-500"></p>
                        <button type="submit" class="w-full px-4 py-3 font-semibold text-white bg-blue-600 rounded-lg hover:bg-blue-700">Đăng ký</button>
                    </form>
                </div>
            </div>
        </div>
        
        <!-- Module làm bài thi -->
        <div id="test-module-page" class="page">
             <div class="flex flex-col items-center justify-center min-h-screen p-4">
                <div id="start-test-view" class="text-center w-full max-w-3xl">
                    <div class="bg-white p-8 rounded-xl shadow-lg max-w-2xl mx-auto border border-slate-200">
                        <h2 id="question-title" class="text-2xl font-semibold mb-4 text-slate-800"></h2>
                        <p class="text-slate-600 mb-2">You should say:</p>
                        <ul id="question-cues" class="list-disc list-inside text-slate-500 mb-6 text-left"></ul>
                        <div class="flex flex-col sm:flex-row gap-4">
                            <button id="suggest-answer-btn" class="w-full sm:w-1/2 bg-gray-200 hover:bg-gray-300 text-slate-800 font-bold py-3 px-6 rounded-lg transition duration-300">✨ Gợi ý câu trả lời</button>
                            <button id="start-btn" class="w-full sm:w-1/2 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300 text-lg shadow-md">Bắt đầu nói</button>
                        </div>
                    </div>
                </div>
                <div id="recording-view" class="hidden text-center">
                    <div class="mb-8 w-28 h-28 bg-blue-600 rounded-full flex items-center justify-center mx-auto pulsing-mic"><i class="fa-solid fa-microphone-lines text-5xl text-white"></i></div>
                    <h2 class="text-3xl font-bold mb-2 text-slate-900">Đang ghi âm...</h2>
                    <p class="text-slate-500 text-lg mb-4">Hãy trả lời câu hỏi đã cho.</p>
                    <div id="timer" class="text-5xl font-bold text-blue-500 mb-8">2:00</div>
                    <button id="stop-btn" class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-8 rounded-lg transition duration-300 text-lg shadow-md">Dừng & Nộp bài</button>
                </div>
            </div>
        </div>
        
        <!-- Màn hình chờ chấm điểm -->
        <div id="loading-page" class="page">
             <div class="flex flex-col items-center justify-center min-h-screen text-center p-4">
                <div class="loader mx-auto mb-6"></div>
                <h2 class="text-3xl font-bold mb-2 text-slate-900">Đang phân tích bài nói...</h2>
                <p class="text-slate-500">AI đang lắng nghe và chấm điểm. Quá trình này có thể mất một chút thời gian.</p>
            </div>
        </div>

        <!-- Màn hình kết quả -->
        <div id="results-page" class="page">
            <div class="w-full max-w-7xl mx-auto my-12 p-4">
                <div class="bg-white p-6 md:p-8 rounded-2xl shadow-2xl border border-slate-200">
                    <div class="flex border-b border-slate-200 mb-6">
                        <div class="tab active flex items-center py-3 px-4 text-blue-600 border-b-2 border-blue-600">
                            <i class="fa-solid fa-file-lines mr-2"></i>
                            <span class="font-semibold">Part 2</span>
                            <span id="part2-score" class="ml-2 bg-blue-100 text-blue-700 font-bold text-sm px-2 py-0.5 rounded-full">0.0</span>
                        </div>
                    </div>
                    <div class="flex flex-col lg:flex-row gap-8">
                        <!-- Left Sidebar -->
                        <div class="w-full lg:w-1/4">
                            <h3 class="font-bold text-lg mb-2">Score Breakdown</h3>
                            <p class="text-sm text-slate-500 mb-4">Click vào từng mục để xem chi tiết.</p>
                            <div id="sidebar-container" class="space-y-2">
                                <!-- Sidebar items will be dynamically generated here -->
                            </div>
                        </div>
                        <!-- Right Content -->
                        <div id="content-container" class="w-full lg:w-3/4 p-6 bg-slate-50 rounded-xl">
                            <!-- Content will be dynamically generated here -->
                        </div>
                    </div>
                </div>
                <!-- Topic Expansion Section -->
                <div class="mt-8 bg-white p-6 md:p-8 rounded-2xl shadow-2xl border border-slate-200">
                    <button id="expand-topic-btn" class="w-full text-left font-bold text-xl mb-4 flex justify-between items-center">
                        <span>✨ Mở rộng & Luyện tập thêm</span>
                        <i class="fa-solid fa-chevron-down"></i>
                    </button>
                    <div id="expand-topic-content" class="hidden prose max-w-none prose-headings:font-semibold prose-headings:text-lg prose-li:my-1">
                        <!-- Content will be injected here -->
                    </div>
                </div>
                <div class="text-center mt-8">
                    <button id="try-again-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg transition duration-300 shadow-md">Làm bài thi khác</button>
                </div>
            </div>
        </div>

        <!-- NEW: Trang lịch sử -->
        <div id="history-page" class="page">
            <div class="container mx-auto max-w-4xl my-12 p-4">
                <div class="bg-white p-8 rounded-xl shadow-lg border border-slate-200">
                    <h2 class="text-3xl font-bold text-slate-800 mb-6">Lịch sử làm bài</h2>
                    <div id="history-list" class="space-y-4">
                        <!-- History items will be injected here -->
                    </div>
                </div>
            </div>
        </div>


        <!-- Màn hình lỗi -->
        <div id="error-page" class="page">
            <div class="flex flex-col items-center justify-center min-h-screen text-center p-4">
                <h2 class="text-3xl font-bold text-red-500 mb-4">Đã có lỗi xảy ra</h2>
                <p id="error-message" class="text-slate-500 mb-6 max-w-md"></p>
                <button id="retry-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg">Thử lại</button>
            </div>
        </div>
    </main>
    
    <!-- Modal for Suggested Answer -->
    <div id="suggestion-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-2xl font-bold">Bài nói mẫu</h3>
                <button id="close-modal-btn" class="text-2xl">&times;</button>
            </div>
            <div id="suggestion-content" class="prose max-w-none text-slate-700">
                <!-- Content will be injected here -->
            </div>
        </div>
    </div>


    <!-- Firebase SDK -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { 
            getAuth, 
            onAuthStateChanged,
            createUserWithEmailAndPassword,
            signInWithEmailAndPassword,
            signOut
        } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { 
            getFirestore, 
            doc, 
            setDoc,
            addDoc,
            collection,
            getDocs,
            Timestamp
        } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        // --- Firebase Initialization ---
        const firebaseConfig = {
            apiKey: "AIzaSyCMxajyXZ5P3N2IFgma3NfwNqQo5LSK6Is",
            authDomain: "test-ielts-speaking.firebaseapp.com",
            projectId: "test-ielts-speaking",
            storageBucket: "test-ielts-speaking.appspot.com",
            messagingSenderId: "630605740510",
            appId: "1:630605740510:web:8d0afb4192728c3b42854f",
            measurementId: "G-QD2F4L47VM"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        // --- Gemini API Config ---
        const GEMINI_API_KEY = "AIzaSyD8movWflsLtk9E6YTzLqVuc17y2vcLd0Y";
        const GEMINI_MODEL = "gemini-2.5-flash-preview-05-20";
        const GEMINI_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_MODEL}:generateContent?key=${GEMINI_API_KEY}`;


        // --- State Variables ---
        let mediaRecorder;
        let audioChunks = [];
        let timerInterval;
        let wpmChartInstance, wpmGaugeInstance;
        let currentQuestion = {};
        let userTranscript = "";
        let currentResultsData = {};
        
        const questions = [
            { title: "Describe a historical place you have visited.", cues: ["what it is", "where it is located", "what is its historical significance", "and explain how you felt about visiting it."] },
            { title: "Describe a book you have read recently.", cues: ["what kind of book it is", "what the main story is about", "what you learned from it", "and explain why you would or would not recommend it to others."] },
            { title: "Describe a memorable trip you have taken.", cues: ["where you went", "who you went with", "what you did there", "and explain why it was so memorable for you."] },
            { title: "Describe a skill you would like to learn.", cues: ["what the skill is", "why you want to learn it", "how you would learn it", "and explain how you think this skill would help you in the future."] },
            { title: "Describe your favorite movie.", cues: ["what the movie is called", "what it is about", "who the main actors are", "and explain why it is your favorite movie."] }
        ];

        // --- UI Elements ---
        const authNavLoggedIn = document.getElementById('auth-nav-logged-in');
        const authNavLoggedOut = document.getElementById('auth-nav-logged-out');
        const userEmailDisplay = document.getElementById('user-email-display');

        // --- Auth State Management ---
        onAuthStateChanged(auth, user => {
            if (user) {
                authNavLoggedIn.classList.remove('hidden');
                authNavLoggedIn.classList.add('flex');
                authNavLoggedOut.classList.add('hidden');
                userEmailDisplay.textContent = user.email;
                if(document.getElementById('auth-page').classList.contains('active')) {
                    loadQuestion();
                    showPage('test-module');
                }
            } else {
                authNavLoggedIn.classList.add('hidden');
                authNavLoggedOut.classList.remove('hidden');
                userEmailDisplay.textContent = '';
            }
        });

        // --- Auth Form Logic ---
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = loginForm['login-email'].value;
            const password = loginForm['login-password'].value;
            document.getElementById('login-error').textContent = "";
            signInWithEmailAndPassword(auth, email, password).catch(err => document.getElementById('login-error').textContent = "Email hoặc mật khẩu không đúng.");
        });
        registerForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = registerForm['register-email'].value;
            const password = registerForm['register-password'].value;
            document.getElementById('register-error').textContent = "";
            createUserWithEmailAndPassword(auth, email, password)
                .then(cred => setDoc(doc(db, "users", cred.user.uid), { email: cred.user.email, createdAt: new Date() }))
                .catch(err => document.getElementById('register-error').textContent = "Email đã tồn tại hoặc mật khẩu quá yếu.");
        });
        document.getElementById('logout-btn').addEventListener('click', () => signOut(auth).then(() => showPage('home')));
        window.switchAuthForm = (form) => {
            const loginTab = document.getElementById('login-tab');
            const registerTab = document.getElementById('register-tab');
            if (form === 'login') {
                loginTab.classList.add('active'); registerTab.classList.remove('active');
                document.getElementById('login-form').classList.add('active'); document.getElementById('register-form').classList.remove('active');
            } else {
                loginTab.classList.remove('active'); registerTab.classList.add('active');
                document.getElementById('login-form').classList.remove('active'); document.getElementById('register-form').classList.add('active');
            }
        }
        
        // --- Page Navigation ---
        window.showPage = (pageId) => {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            const newPage = document.getElementById(pageId + '-page');
            if (newPage) newPage.classList.add('active');
            window.scrollTo(0, 0);
        }
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const pageId = e.currentTarget.dataset.page;
                if (pageId === 'auth' && auth.currentUser) {
                     loadQuestion();
                     showPage('test-module');
                } else if (pageId) {
                    showPage(pageId);
                }
            });
        });

        // --- App Logic ---
        document.getElementById('start-btn').addEventListener('click', () => {
            document.getElementById('start-test-view').classList.add('hidden');
            document.getElementById('recording-view').classList.remove('hidden');
            startRecording();
        });
        document.getElementById('stop-btn').addEventListener('click', stopRecording);
        
        document.getElementById('try-again-btn').addEventListener('click', () => {
             loadQuestion();
             document.getElementById('start-test-view').classList.remove('hidden');
             document.getElementById('recording-view').classList.add('hidden');
             showPage('test-module');
        });
        
        document.getElementById('retry-btn').addEventListener('click', () => {
             loadQuestion();
             document.getElementById('start-test-view').classList.remove('hidden');
             document.getElementById('recording-view').classList.add('hidden');
             showPage('test-module');
        });

        // --- Audio & Timer ---
        async function startRecording() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream, { mimeType: 'audio/webm' });
                mediaRecorder.ondataavailable = event => audioChunks.push(event.data);
                mediaRecorder.onstop = handleRecordingStop;
                mediaRecorder.start();
                startTimer();
            } catch (err) {
                console.error("Mic access error:", err);
                showError("Không thể truy cập microphone. Vui lòng cấp quyền và thử lại.");
            }
        }
        function stopRecording() {
            if (mediaRecorder && mediaRecorder.state === "recording") {
                mediaRecorder.stop();
                clearInterval(timerInterval);
            }
        }
        function handleRecordingStop() {
            showPage('loading');
            const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
            audioChunks = [];
            const reader = new FileReader();
            reader.readAsDataURL(audioBlob);
            reader.onloadend = () => getIeltsScore(reader.result.split(',')[1]);
        }
        function startTimer() {
             let timeLeft = 120;
             const timerEl = document.getElementById('timer');
             const updateDisplay = () => {
                const minutes = Math.floor(timeLeft / 60);
                const seconds = (timeLeft % 60).toString().padStart(2, '0');
                timerEl.textContent = `${minutes}:${seconds}`;
             };
             updateDisplay();
             timerInterval = setInterval(() => {
                timeLeft--;
                updateDisplay();
                if (timeLeft <= 0) stopRecording();
             }, 1000);
        }

        async function fetchWithTimeout(resource, options = {}, timeout = 60000) {
            const controller = new AbortController();
            const id = setTimeout(() => controller.abort(), timeout);

            try {
                const response = await fetch(resource, {
                    ...options,
                    signal: controller.signal
                });
                clearTimeout(id);
                return response;
            } catch (error) {
                clearTimeout(id);
                if (error.name === 'AbortError') {
                    throw new Error('Request timed out. Please check your connection and try again.');
                }
                throw error;
            }
        }

        // --- Gemini API Calls ---
        async function callGemini(prompt) {
            const payload = { contents: [{ parts: [{ text: prompt }] }] };
            const response = await fetchWithTimeout(GEMINI_API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            if (!response.ok) throw new Error(`API Error ${response.status}`);
            const result = await response.json();
            if (!result.candidates || !result.candidates[0].content.parts[0].text) {
                throw new Error("Invalid response structure from API.");
            }
            return result.candidates[0].content.parts[0].text;
        }

        async function getIeltsScore(base64Audio) {
            showPage('loading');
            try {
                const prompt = `You are an expert IELTS examiner. You will be given an audio recording of a user's response to an IELTS Speaking Part 2 question.
                First, transcribe the user's entire response.
                Then, analyze the transcript and the audio characteristics to provide a detailed evaluation based on the official IELTS criteria.
                The question was: "${currentQuestion.title}"
                Cues: ${currentQuestion.cues.join(', ')}.

                Provide your response as a single, valid JSON object. Do not include any text or markdown formatting before or after the JSON object. The JSON object must have the following structure:
                {
                  "transcript": "The full transcription of the user's speech.",
                  "overall_score": A number from 1.0 to 9.0, rounded to the nearest 0.5.
                  "pronunciation": { "score": A number from 1.0 to 9.0, "level": A string like "Good", "Needs Improvement", etc., "percentage": An integer from 0 to 100, "feedback": "Detailed feedback on pronunciation with examples." },
                  "intonation": { "level": A string like "Good", "Needs Improvement", etc., "percentage": An integer from 0 to 100, "feedback": "Detailed feedback on intonation." },
                  "fluency": { "score": A number from 1.0 to 9.0, "level": A string like "Fluent", "Some Hesitation", etc., "percentage": An integer from 0 to 100, "feedback": "Detailed feedback on fluency, coherence, and self-correction.", "pace": A string like "Good", "Too Fast", "Too Slow", "pausing": A string like "Appropriate", "Too Long", etc., "hesitations": A string like "Few", "Many", etc., "pacing_feedback": "Detailed feedback on the speaking rate.", "wpm": An integer representing words per minute, "wpm_timeline": An array of numbers representing WPM over time chunks. },
                  "grammar": { "score": A number from 1.0 to 9.0, "level": A string like "Good Range", "Limited", etc., "percentage": An integer from 0 to 100, "feedback": "Detailed feedback on grammatical range and accuracy with corrected examples from the transcript." },
                  "vocabulary": { "score": A number from 1.0 to 9.0, "level": A string like "Effective", "Repetitive", etc., "percentage": An integer from 0 to 100, "feedback": "Detailed feedback on lexical resource, including use of less common vocabulary and idiomatic language, with examples." }
                }`;

                const payload = {
                    contents: [{
                        parts: [
                            { text: prompt },
                            { inlineData: { mimeType: "audio/webm", data: base64Audio } }
                        ]
                    }],
                    generationConfig: { "responseMimeType": "application/json" }
                };
                
                const response = await fetchWithTimeout(GEMINI_API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorBody = await response.json().catch(() => ({error: {message: "Unknown API error"}}));
                    throw new Error(`API Error ${response.status}: ${errorBody.error?.message || 'Failed to get a valid response from the server.'}`);
                }
                const result = await response.json();

                if (!result.candidates || !result.candidates[0].content.parts[0].text) {
                     throw new Error("API returned an empty or invalid response. This might be due to safety settings or an issue with the prompt.");
                }

                let parsedData;
                const responseText = result.candidates[0].content.parts[0].text;
                
                try {
                    parsedData = JSON.parse(responseText);
                } catch (e) {
                    console.error("Failed to parse JSON:", responseText);
                    throw new Error("The AI returned an invalid data format. Please try again.");
                }
                
                await saveTestResult(parsedData);
                displayResults(parsedData);
            } catch (error) {
                console.error("Scoring error:", error);
                showError(error.message);
            }
        }
        
        document.getElementById('suggest-answer-btn').addEventListener('click', async () => {
            const modal = document.getElementById('suggestion-modal');
            const contentEl = document.getElementById('suggestion-content');
            modal.classList.remove('hidden');
            contentEl.innerHTML = '<div class="loader mx-auto"></div>';
            
            try {
                const prompt = `You are an expert IELTS instructor. For the following IELTS Speaking Part 2 topic, please write a high-scoring, well-structured sample answer of about 250 words. The topic is: "${currentQuestion.title}" with the cues: ${currentQuestion.cues.join(', ')}. The response should be in English.`;
                const result = await callGemini(prompt);
                contentEl.innerHTML = result.replace(/\n/g, '<br>');
            } catch (error) {
                contentEl.textContent = "Không thể tạo gợi ý lúc này. Vui lòng thử lại.";
                console.error("Suggestion error:", error);
            }
        });

        document.getElementById('expand-topic-btn').addEventListener('click', async () => {
            const contentEl = document.getElementById('expand-topic-content');
            const btn = document.getElementById('expand-topic-btn');
            const icon = btn.querySelector('i');

            if (contentEl.classList.contains('hidden')) {
                contentEl.classList.remove('hidden');
                icon.classList.replace('fa-chevron-down', 'fa-chevron-up');
                if (contentEl.innerHTML.trim() === "") { // Only fetch if content is empty
                    contentEl.innerHTML = '<div class="loader mx-auto"></div>';
                    try {
                        const prompt = `You are an expert IELTS instructor. Based on the user's answer to an IELTS Speaking Part 2 question, provide some materials for further practice. The original question was: "${currentQuestion.title}". The user's answer was: "${userTranscript}". Please provide: 1. A list of 5-7 advanced vocabulary words or phrases relevant to the topic with brief Vietnamese definitions. 2. A list of 2-3 relevant idioms with explanations in English and Vietnamese. 3. A list of 3-4 potential IELTS Speaking Part 3 follow-up questions. Format your response clearly in Markdown.`;
                        const result = await callGemini(prompt);
                        // FIX: Use marked.parse to correctly render markdown
                        contentEl.innerHTML = marked.parse(result);
                    } catch (error) {
                        contentEl.textContent = "Không thể tạo nội dung mở rộng lúc này. Vui lòng thử lại.";
                        console.error("Expansion error:", error);
                    }
                }
            } else {
                contentEl.classList.add('hidden');
                icon.classList.replace('fa-chevron-up', 'fa-chevron-down');
            }
        });

        document.getElementById('close-modal-btn').addEventListener('click', () => {
            document.getElementById('suggestion-modal').classList.add('hidden');
        });

        // --- History Feature ---
        async function saveTestResult(data) {
            const user = auth.currentUser;
            if (!user) return; // Don't save if not logged in

            try {
                await addDoc(collection(db, "users", user.uid, "history"), {
                    overall_score: data.overall_score || 0,
                    questionTitle: currentQuestion.title,
                    date: Timestamp.now(),
                    full_data: JSON.stringify(data) // Store full data for potential detailed view later
                });
            } catch (error) {
                console.error("Error saving test result: ", error);
            }
        }

        async function loadHistory() {
            const user = auth.currentUser;
            const historyListEl = document.getElementById('history-list');
            if (!user) {
                historyListEl.innerHTML = '<p>Vui lòng đăng nhập để xem lịch sử.</p>';
                return;
            };

            historyListEl.innerHTML = '<div class="loader mx-auto"></div>';
            
            try {
                const historyCollection = collection(db, "users", user.uid, "history");
                const querySnapshot = await getDocs(historyCollection);
                
                if (querySnapshot.empty) {
                    historyListEl.innerHTML = '<p class="text-center text-slate-500">Bạn chưa có bài thi nào trong lịch sử.</p>';
                    return;
                }

                historyListEl.innerHTML = ''; // Clear loader
                const results = [];
                querySnapshot.forEach(doc => {
                    results.push({ id: doc.id, ...doc.data() });
                });

                // Sort by date, newest first
                results.sort((a, b) => b.date.seconds - a.date.seconds);

                results.forEach(data => {
                    const date = data.date.toDate();
                    const formattedDate = `${date.toLocaleDateString('vi-VN')} ${date.toLocaleTimeString('vi-VN')}`;
                    const itemEl = document.createElement('div');
                    itemEl.className = 'bg-slate-50 p-4 rounded-lg flex justify-between items-center hover:bg-slate-100 transition-colors';
                    itemEl.innerHTML = `
                        <div>
                            <p class="font-semibold text-slate-800">${data.questionTitle}</p>
                            <p class="text-sm text-slate-500">${formattedDate}</p>
                        </div>
                        <div class="text-2xl font-bold text-blue-600">
                            ${(data.overall_score).toFixed(1)}
                        </div>
                    `;
                    historyListEl.appendChild(itemEl);
                });

            } catch (error) {
                console.error("Error loading history: ", error);
                historyListEl.innerHTML = '<p class="text-center text-red-500">Không thể tải lịch sử. Vui lòng thử lại.</p>';
            }
        }

        document.getElementById('history-link').addEventListener('click', async (e) => {
            e.preventDefault();
            await loadHistory();
            showPage('history');
        });


        // --- UI Updates & Rendering ---
        function displayResults(data) {
            currentResultsData = data;
            userTranscript = data.transcript || ""; // Save transcript for expansion feature
            document.getElementById('part2-score').textContent = (data.overall_score || 0).toFixed(1);
            
            renderSidebar(data);
            renderContent('fluency'); // Show fluency by default
            
            showPage('results');
        }

        function renderSidebar(data) {
            const container = document.getElementById('sidebar-container');
            container.innerHTML = '';
            const criteria = [
                { id: 'fluency', name: 'Fluency', icon: 'fa-comments', data: data.fluency },
                { id: 'pronunciation', name: 'Pronunciation', icon: 'fa-microphone-lines', data: data.pronunciation },
                { id: 'grammar', name: 'Grammar', icon: 'fa-spell-check', data: data.grammar },
                { id: 'vocabulary', name: 'Vocabulary', icon: 'fa-book-open', data: data.vocabulary },
                { id: 'intonation', name: 'Intonation', icon: 'fa-wave-square', data: data.intonation },
            ];

            criteria.forEach((item, index) => {
                const itemData = item.data || {};
                const el = document.createElement('div');
                el.id = `sb-${item.id}`;
                el.className = `sidebar-item flex justify-between items-center p-3 rounded-lg cursor-pointer transition-colors duration-200 hover:bg-slate-100 ${index === 0 ? 'active' : ''}`;
                el.innerHTML = `
                    <div class="flex items-center">
                        <i class="fa-solid ${item.icon} mr-3 text-blue-500 w-6 text-center"></i>
                        <div>
                            <p class="font-semibold">${item.name}</p>
                            <p class="text-sm text-slate-500">${itemData.level || 'N/A'}</p>
                        </div>
                    </div>
                    <i class="fa-solid fa-chevron-right"></i>
                `;
                el.addEventListener('click', () => renderContent(item.id));
                container.appendChild(el);
            });
        }

        function renderContent(criteriaId) {
            document.querySelectorAll('.sidebar-item').forEach(el => el.classList.remove('active'));
            document.getElementById(`sb-${criteriaId}`).classList.add('active');

            const container = document.getElementById('content-container');
            const data = currentResultsData[criteriaId];
            if (!data) {
                container.innerHTML = '<p>No data available for this section.</p>';
                return;
            }

            let contentHTML = `
                <div class="flex items-center justify-between mb-4">
                    <div>
                        <p class="text-sm text-slate-500">Your Level</p>
                        <h4 class="text-2xl font-bold">${data.level || 'N/A'}</h4>
                    </div>
                    <div class="text-right">
                        <p class="text-3xl font-bold text-blue-600">${data.percentage ? `${data.percentage}%` : '-'}</p>
                    </div>
                </div>
                <div class="w-full progress-bar-bg rounded-full h-2.5 mb-4">
                    <div class="progress-bar-fill h-2.5 rounded-full" style="width: ${data.percentage || 0}%"></div>
                </div>
                <h5 class="font-bold text-lg mt-6 mb-2">Feedback</h5>
                <p class="text-slate-600 mb-8">${data.feedback || 'No feedback available.'}</p>
            `;

            if (criteriaId === 'fluency') {
                contentHTML += `
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8 border-t pt-6 mt-6">
                        <div class="text-center"><p class="text-sm text-slate-500">Pace</p><p class="font-semibold text-lg">${data.pace || 'N/A'}</p></div>
                        <div class="text-center"><p class="text-sm text-slate-500">Pausing</p><p class="font-semibold text-lg">${data.pausing || 'N/A'}</p></div>
                        <div class="text-center"><p class="text-sm text-slate-500">Hesitations</p><p class="font-semibold text-lg">${data.hesitations || 'N/A'}</p></div>
                    </div>
                    <div class="flex flex-col md:flex-row items-center gap-6 mb-8">
                        <div class="w-full md:w-1/3">
                            <div class="relative w-full" style="padding-bottom: 50%;">
                                <canvas id="wpm-gauge"></canvas>
                            </div>
                        </div>
                        <div class="w-full md:w-2/3">
                            <h5 class="font-bold text-lg">Pacing</h5>
                            <p class="text-slate-600">${data.pacing_feedback || ''}</p>
                        </div>
                    </div>
                    <h5 class="font-bold text-lg mb-4">Pacing Overview</h5>
                    <div class="h-64"><canvas id="wpm-chart"></canvas></div>
                `;
            }
             if (criteriaId === 'pronunciation' || criteriaId === 'grammar' || criteriaId === 'vocabulary') {
                contentHTML += `
                <div class="border-t pt-6 mt-6">
                 <h5 class="font-bold text-lg mb-2">Transcript</h5>
                 <p class="text-slate-600 bg-white p-4 rounded-lg">${userTranscript}</p>
                </div>
                `;
            }

            container.innerHTML = contentHTML;

            if (criteriaId === 'fluency' && data.wpm && data.wpm_timeline) {
                renderWpmGauge(data.wpm);
                renderWpmChart(data.wpm_timeline);
            }
        }

        function renderWpmGauge(wpm) {
            const ctx = document.getElementById('wpm-gauge')?.getContext('2d');
            if (!ctx) return;
            if (wpmGaugeInstance) wpmGaugeInstance.destroy();
            wpmGaugeInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['WPM', ''],
                    datasets: [{
                        data: [wpm, 200 - wpm],
                        backgroundColor: ['#3b82f6', '#e5e7eb'],
                        borderWidth: 0,
                    }]
                },
                options: {
                    rotation: -90,
                    circumference: 180,
                    cutout: '70%',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false }, tooltip: { enabled: false } }
                }
            });
        }

        function renderWpmChart(wpmData) {
            const ctx = document.getElementById('wpm-chart')?.getContext('2d');
            if (!ctx || !wpmData) return;
            if (wpmChartInstance) wpmChartInstance.destroy();
            wpmChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: wpmData.map((_, i) => `Seg ${i+1}`),
                    datasets: [{
                        label: 'Words Per Minute',
                        data: wpmData,
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false }
            });
        }

        function showError(message) {
            document.getElementById('error-message').textContent = message;
            showPage('error');
        }
        function loadQuestion() {
             const question = questions[Math.floor(Math.random() * questions.length)];
             currentQuestion = question;
             document.getElementById('question-title').textContent = question.title;
             const cuesEl = document.getElementById('question-cues');
             cuesEl.innerHTML = '';
             question.cues.forEach(cue => {
                const li = document.createElement('li');
                li.textContent = cue;
                cuesEl.appendChild(li);
             });
             // Reset expansion content for the new question
             const expandContent = document.getElementById('expand-topic-content');
             expandContent.innerHTML = '';
             expandContent.classList.add('hidden');
             document.getElementById('expand-topic-btn').querySelector('i').classList.replace('fa-chevron-up', 'fa-chevron-down');
        }

        // --- Initial Load ---
        showPage('home');
    </script>

</body>
</html>
